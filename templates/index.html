<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InsightBoard AI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      padding: 30px;
      background: #f8f9fa;
      font-family: 'Arial', sans-serif;
    }
    textarea {
      height: 150px;
      border-color: #007bff;
    }
    .completed {
      text-decoration: line-through;
      color: #6c757d;
    }
    .task-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.2s;
    }
    .task-item:hover {
      transform: scale(1.02);
    }
    .chart-wrapper {
      position: relative;
      width: 100%;
      max-width: 400px;
      margin: auto;
    }
    canvas {
      max-width: 100%;
    }
    .card {
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: none;
      margin-bottom: 20px;
      animation: fadeIn 1s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .card-title {
      color: #007bff;
    }
    .btn-primary {
      background-color: #007bff;
      border-color: #007bff;
      transition: background-color 0.3s, transform 0.2s;
    }
    .btn-primary:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
    }
    .btn-success {
      background-color: #28a745;
      border-color: #28a745;
      transition: background-color 0.3s, transform 0.2s;
    }
    .btn-success:hover {
      background-color: #218838;
      transform: translateY(-2px);
    }
    .btn-outline-danger {
      color: #dc3545;
      border-color: #dc3545;
      transition: background-color 0.3s, color 0.3s, transform 0.2s;
    }
    .btn-outline-danger:hover {
      background-color: #dc3545;
      color: #fff;
      transform: translateY(-2px);
    }
    .form-select {
      border-color: #007bff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4 text-center" style="color: #007bff;">üß† InsightBoard AI</h1>
    <!-- Transcript Input -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Paste Meeting Transcript</h5>
        <textarea id="transcript" class="form-control mb-3" placeholder="e.g., John will send the report. Lisa will call the client."></textarea>
        <button class="btn btn-primary" onclick="submitTranscript()">Generate Action Items</button>
      </div>
    </div>
    <!-- Filter and Sort Controls -->
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="filter" class="form-label">Filter by Status:</label>
        <select id="filter" class="form-select" onchange="filterTasks()">
          <option value="all">All</option>
          <option value="completed">Completed</option>
          <option value="pending">Pending</option>
        </select>
      </div>
      <div class="col-md-6">
        <label for="sort" class="form-label">Sort by:</label>
        <select id="sort" class="form-select" onchange="sortTasks()">
          <option value="default">Default</option>
          <option value="alphabetical">Alphabetical</option>
          <option value="creation">Creation Date</option>
        </select>
      </div>
    </div>
    <!-- Task List -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">üìù Action Items</h5>
        <ul id="taskList" class="list-group"></ul>
        <p class="mt-3 text-muted" id="taskCount">0 of 0 tasks completed</p>
      </div>
    </div>
    <!-- Chart -->
    <div class="card">
      <div class="card-body text-center">
        <h5 class="card-title">üìä Task Completion</h5>
        <div class="chart-wrapper">
          <canvas id="progressChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <script>
    let tasks = [];
    let deletedCompleted = 0;

    function submitTranscript() {
      const transcript = document.getElementById("transcript").value.trim();
      if (!transcript) return alert("Please enter a transcript");

      fetch("/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ transcript }),
      })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          alert("Error generating tasks: " + data.error);
        } else {
          tasks = data.tasks.map(t => ({ text: t, done: false }));
          deletedCompleted = 0;
          renderTasks();
        }
      })
      .catch(err => alert("Error generating tasks: " + err));
    }

    function renderTasks() {
      const list = document.getElementById("taskList");
      const countText = document.getElementById("taskCount");
      list.innerHTML = "";
      tasks.forEach((task, index) => {
        const li = document.createElement("li");
        li.className = "list-group-item task-item";
        const left = document.createElement("span");
        left.textContent = task.text;
        if (task.done) left.classList.add("completed");

        const btnGroup = document.createElement("div");
        const completeBtn = document.createElement("button");
        completeBtn.className = "btn btn-sm btn-success me-2";
        completeBtn.textContent = "‚úÖ";
        completeBtn.title = "Mark as Done";
        completeBtn.onclick = () => {
          if (!task.done) {
            tasks[index].done = true;
            renderTasks();
          }
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn btn-sm btn-outline-danger";
        deleteBtn.textContent = "üóëÔ∏è";
        deleteBtn.title = "Delete Task";
        deleteBtn.onclick = () => {
          if (task.done) deletedCompleted += 1;
          tasks.splice(index, 1);
          renderTasks();
        };

        btnGroup.appendChild(completeBtn);
        btnGroup.appendChild(deleteBtn);
        li.appendChild(left);
        li.appendChild(btnGroup);
        list.appendChild(li);
      });

      const done = tasks.filter(t => t.done).length;
      const total = tasks.length + deletedCompleted;
      const totalDone = done + deletedCompleted;
      countText.textContent = `${totalDone} of ${total} tasks completed`;
      updateChart(totalDone, total - totalDone);
    }

    function filterTasks() {
      const filter = document.getElementById("filter").value;
      const list = document.getElementById("taskList");
      list.innerHTML = "";

      tasks.filter(task => {
        if (filter === "all") return true;
        if (filter === "completed") return task.done;
        if (filter === "pending") return !task.done;
      }).forEach((task, index) => {
        const li = document.createElement("li");
        li.className = "list-group-item task-item";
        const left = document.createElement("span");
        left.textContent = task.text;
        if (task.done) left.classList.add("completed");

        const btnGroup = document.createElement("div");
        const completeBtn = document.createElement("button");
        completeBtn.className = "btn btn-sm btn-success me-2";
        completeBtn.textContent = "‚úÖ";
        completeBtn.title = "Mark as Done";
        completeBtn.onclick = () => {
          if (!task.done) {
            tasks[index].done = true;
            renderTasks();
          }
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn btn-sm btn-outline-danger";
        deleteBtn.textContent = "üóëÔ∏è";
        deleteBtn.title = "Delete Task";
        deleteBtn.onclick = () => {
          if (task.done) deletedCompleted += 1;
          tasks.splice(index, 1);
          renderTasks();
        };

        btnGroup.appendChild(completeBtn);
        btnGroup.appendChild(deleteBtn);
        li.appendChild(left);
        li.appendChild(btnGroup);
        list.appendChild(li);
      });
    }

    function sortTasks() {
      const sort = document.getElementById("sort").value;
      if (sort === "alphabetical") {
        tasks.sort((a, b) => a.text.localeCompare(b.text));
      } else if (sort === "creation") {
        // Sort by creation date if available
      }
      renderTasks();
    }

    function updateChart(done, pending) {
      const ctx = document.getElementById("progressChart").getContext("2d");
      if (window.pieChart instanceof Chart) window.pieChart.destroy();

      window.pieChart = new Chart(ctx, {
        type: "pie",
        data: {
          labels: ["‚úÖ Completed", "üïó Pending"],
          datasets: [{
            data: [done, pending],
            backgroundColor: ["#007bff", "#6c757d"],
            borderColor: "#fff",
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: "bottom",
              labels: {
                color: "#000",
                font: { size: 14 }
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
